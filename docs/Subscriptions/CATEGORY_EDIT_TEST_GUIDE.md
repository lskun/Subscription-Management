# 分类编辑修复测试指南

## 问题背景
用户在编辑分类时遇到主键约束违反错误（错误代码：23505）。

## 修复内容
修改了`src/store/subscriptionStore.ts`中的`editCategory`方法，直接使用传递的ID进行更新，避免不必要的查询。

## 测试步骤

### 1. 启动应用
```bash
npm run dev
```

### 2. 打开浏览器开发者工具
- 按F12打开开发者工具
- 切换到Network标签页
- 切换到Console标签页查看日志

### 3. 进入设置页面
- 访问 http://localhost:5173
- 点击"Go to Dashboard"
- 点击左侧菜单的"设置"

### 4. 测试分类编辑
1. 在分类管理区域，找到一个用户自定义分类（非系统默认分类）
2. 点击分类右上角的编辑按钮（铅笔图标）
3. 修改分类名称
4. 点击"保存"按钮

### 5. 验证结果
**修复前的问题：**
- 浏览器控制台会显示错误：`duplicate key value violates unique constraint "categories_pkey"`
- 分类编辑失败
- 显示"分类值已存在"的错误提示

**修复后的预期结果：**
- 分类编辑成功
- 显示"更新成功"的提示
- 分类列表中显示更新后的名称
- 浏览器控制台没有错误信息

### 6. 网络请求验证
在Network标签页中，观察编辑分类时的网络请求：

**修复前：**
- 会有多个查询请求
- 可能出现错误的SELECT请求

**修复后：**
- 只有必要的UPDATE请求
- 请求成功返回200状态码

## 测试用例

### 测试用例1：编辑分类名称
1. 选择一个用户分类
2. 修改分类名称（如：从"娱乐"改为"娱乐服务"）
3. 保存更改
4. 验证更新成功

### 测试用例2：编辑分类值和名称
1. 选择一个用户分类
2. 修改分类名称（这会自动生成新的value）
3. 保存更改
4. 验证更新成功

### 测试用例3：编辑后取消
1. 选择一个用户分类
2. 修改分类名称
3. 点击"取消"按钮
4. 验证没有发生更改

## 故障排除

如果仍然出现错误：

1. **检查浏览器控制台**：查看详细的错误信息
2. **检查网络请求**：确认请求的URL和参数
3. **清除浏览器缓存**：刷新页面重新加载
4. **检查数据库状态**：确认分类数据的完整性

## 相关文件
- `src/store/subscriptionStore.ts` - 修复的主要文件
- `src/components/subscription/OptionsManager.tsx` - 分类编辑UI
- `src/services/supabaseCategoriesService.ts` - 分类服务

## 预期修复效果
- ✅ 分类编辑功能正常工作
- ✅ 不再出现主键约束错误
- ✅ 提高编辑操作的性能
- ✅ 减少不必要的数据库查询